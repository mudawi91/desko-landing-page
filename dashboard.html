<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DeskGo Agent Dashboard - Ticket View</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="./favicon.png"> 
    <script src="data.js"></script> 
    <style>
        /* GLOBAL STYLES */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background-color: #f3f4f6; /* Light gray background for app feel */
            color: #111827;
            display: flex;
            height: 100vh;
            overflow: hidden; /* Prevent body scroll */
        }
        a {
            text-decoration: none;
            color: inherit;
        }

        /* UTILITY CLASSES */
        .deskgo-blue { color: #2563eb; }
        .bg-deskgo-blue { background-color: #2563eb; }
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .status-open { background-color: #fef3c7; color: #b45309; }
        /* Reusing priority colors for status/badge consistency */
        .status-high { background-color: #fee2e2; color: #dc2626; } /* Red for High Priority */
        .status-medium { background-color: #fef3cc; color: #a37604; } /* Yellow for Medium Priority */
        .status-low { background-color: #d1fae5; color: #065f46; } /* Green for Low Priority */

        .status-automated { background-color: #d1fae5; color: #065f46; }


        /* LAYOUT */
        .main-layout {
            display: flex;
            flex-grow: 1;
        }

        /* TICKET LOAD ANIMATION KEYFRAMES */
        @keyframes ticketLoad {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* TICKET LOAD ANIMATION CLASS */
        .ticket-area.load-animation {
            animation: ticketLoad 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }


        /* 1. SIDEBAR NAVIGATION */
        .sidebar {
            width: 250px;
            background-color: #ffffff;
            border-right: 1px solid #e5e7eb;
            padding: 1.5rem 1rem;
            flex-shrink: 0;
            overflow-y: auto;
        }
        /* LOGO STYLED FOR IMAGE */
        .sidebar-logo {
            margin-bottom: 2rem;
            display: block;
        }
        .sidebar-logo img {
            height: 80px; /* INCREASED SIZE FROM 40px TO 50px */
            vertical-align: middle;
        }
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.95rem;
            color: #4b5563;
            transition: background-color 0.15s;
        }
        .nav-item:hover {
            background-color: #f3f4f6;
        }
        .nav-item.active {
            background-color: #e0f2fe;
            color: #2563eb;
            font-weight: 600;
        }
        .nav-icon {
            margin-right: 0.75rem;
            font-size: 1.1rem; 
        }

        /* 2. TICKET VIEW AREA */
        .ticket-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            /* Initial state for animation */
            opacity: 0;
        }

        /* TICKET HEADER (Top Bar) */
        .ticket-header {
            padding: 1rem 2rem;
            background-color: white;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }
        .ticket-title-group h1 {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        .ticket-title-group span {
            font-size: 0.85rem;
            color: #6b7280;
        }
        .header-actions .btn {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.15s;
        }
        .btn-smart {
            background-color: #2563eb;
            color: white;
            margin-right: 0.5rem;
        }
        .btn-smart:hover {
            background-color: #1d4ed8;
        }

        /* CONTENT SPLIT (Chat + Properties) */
        .content-split {
            display: flex;
            flex-grow: 1;
            overflow: hidden;
        }

        /* CHAT THREAD */
        .chat-thread-wrapper {
            flex-grow: 1;
            max-width: 800px; /* Max width for chat readability */
            background-color: #ffffff;
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            padding: 0 0 0 2rem;
        }
        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 2rem 2rem 0 0;
        }

        /* Message Bubbles */
        .message {
            margin-bottom: 1.5rem;
            display: flex;
            align-items: flex-start;
        }
        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #9ca3af;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            flex-shrink: 0;
            margin-right: 1rem;
        }
        .message-content {
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            max-width: 80%;
            line-height: 1.4;
        }
        /* RTL SPECIFIC STYLES */
        .message-content.rtl {
            direction: rtl;
            text-align: right;
            /* Ensures Arabic font is clean if browser defaults are poor */
            font-family: 'Arial', 'Tahoma', sans-serif; 
        }

        .user-message .message-avatar { background-color: #facc15; }
        .user-message .message-content {
            background-color: #f3f4f6;
            color: #111827;
        }
        .agent-message { justify-content: flex-end; }
        .agent-message .message-avatar { background-color: #2563eb; order: 2; margin-right: 0; margin-left: 1rem; }
        .agent-message .message-content {
            background-color: #2563eb;
            color: white;
            order: 1;
        }
        .message-info {
            font-size: 0.75rem;
            color: #9ca3af;
            margin-top: 0.25rem;
        }
        .agent-message .message-info { text-align: right; }

        /* Automation Message */
        .automation-message {
            text-align: center;
            margin: 2rem 0;
            font-size: 0.85rem;
            color: #065f46;
        }
        .automation-message span {
            background-color: #d1fae5;
            padding: 0.5rem 1.25rem;
            border-radius: 999px;
            font-weight: 600;
        }

        /* Reply Box */
        .reply-box {
            padding: 1rem 2rem 1.5rem 0;
            flex-shrink: 0;
            border-top: 1px solid #e5e7eb;
        }
        .reply-box textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            resize: none;
            font-family: inherit;
            font-size: 1rem;
            min-height: 80px;
        }
        .reply-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 0.5rem;
        }
        .btn-reply {
            background-color: #2563eb;
            color: white;
            padding: 0.6rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.15s;
        }

        /* 3. PROPERTIES PANEL */
        .properties-panel {
            width: 300px;
            flex-shrink: 0;
            background-color: #ffffff;
            padding: 1.5rem;
            overflow-y: auto;
        }
        .panel-group {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .panel-group:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }
        .panel-title {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: #4b5563;
        }
        .property {
            display: flex;
            justify-content: space-between;
            font-size: 0.95rem;
            margin-bottom: 0.4rem;
        }
        .property-label {
            color: #6b7280;
        }
        .property-value {
            font-weight: 500;
        }
        .log-entry {
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            border-radius: 0.5rem;
            background-color: #f9fafb;
            border-left: 3px solid #10b981; /* Green for automation success */
        }
        .log-entry.manual {
            border-left: 3px solid #f97316; /* Orange for manual action */
        }
        .log-entry-time {
            color: #9ca3af;
            font-size: 0.75rem;
            display: block;
            margin-top: 0.2rem;
        }
    </style>
</head>
<body>
    <div class="main-layout">
        <div class="sidebar">
            <a href="index.html" class="sidebar-logo">
                <img src="./logo.png" alt="DeskGo Logo" style="height: 120px;"> </a>

            <a href="tickets.html" class="nav-item">
                <span class="nav-icon">üìä</span> Tickets List
            </a>
            <a href="#" class="nav-item active">
                <span class="nav-icon">üé´</span> Ticket Details
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">‚öôÔ∏è</span> Automations
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">üë§</span> Users & Teams
            </a>
            <a href="#" class="nav-item">
                <span class="nav-icon">üõ†Ô∏è</span> Settings
            </a>
        </div>

        <div class="ticket-area load-animation">

            <div class="ticket-header">
                <div class="ticket-title-group">
                    <span id="ticketStatusBadge" class="status-badge status-open">OPEN</span>
                    <h1 id="ticketTitle">T-000: Loading Ticket Details...</h1>
                    <span id="ticketInfo">Opened by User (user@company.com)</span>
                </div>
                <div class="header-actions">
                    <a href="#" class="btn btn-smart">
                        ‚ú® Run Automation: Password Reset
                    </a>
                    <a href="#" class="btn btn-primary">Close Ticket</a>
                </div>
            </div>

            <div class="content-split">

                <div class="chat-thread-wrapper">
                    <div class="chat-messages">

                        <div class="message user-message">
                            <div class="message-avatar">US</div>
                            <div>
                                <div class="message-content" id="ticketDescriptionContent">
                                    The initial message content will be loaded here based on the ticket ID.
                                </div>
                                <div class="message-info">Ticket Initiator ¬∑ <span id="initialMessageTime">11:30 AM</span></div>
                            </div>
                        </div>

                        <div id="automationTrigger" class="automation-message" style="display: none;">
                            <span>‚úÖ Automation: Priority set to **[PRIORITY]** based on content analysis.</span>
                        </div>

                        <div class="message agent-message">
                            <div>
                                <div class="message-content" id="agentMessageContent">
                                    Thanks for reaching out! I've confirmed your issue and am starting the process now. I will follow up with an update in the next hour.
                                </div>
                                <div class="message-info" id="agentMessageInfo">You (Agent) ¬∑ 11:45 AM</div>
                            </div>
                            <div class="message-avatar">IT</div>
                        </div>

                    </div>

                    <div class="reply-box">
                        <textarea placeholder="Type your reply here... (Supports English and Arabic)"></textarea>
                        <div class="reply-actions">
                            <a href="#" class="btn-reply">Send Reply</a>
                        </div>
                    </div>
                </div>

                <div class="properties-panel">
                    <div class="panel-group">
                        <div class="panel-title">Ticket Details</div>
                        <div class="property">
                            <span class="property-label">Priority</span>
                            <span id="propertyPriority" class="property-value">Loading...</span>
                        </div>
                        <div class="property">
                            <span class="property-label">Category</span>
                            <span id="propertyCategory" class="property-value">Loading...</span>
                        </div>
                        <div class="property">
                            <span class="property-label">Assignee</span>
                            <span class="property-value deskgo-blue">You (Karim)</span>
                        </div>
                        <div class="property">
                            <span class="property-label">SLA</span>
                            <span class="property-value">24 Hours (On Track)</span>
                        </div>
                    </div>

                    <div class="panel-group">
                        <div class="panel-title">Automation & Activity Log</div>

                        <div class="log-entry">
                            **System Automation** executed: Sent auto-reply confirming receipt.
                            <span class="log-entry-time">11:35 AM</span>
                        </div>
                        <div class="log-entry" id="logPriority">
                            **System Automation** triggered: Priority set to **High**.
                            <span class="log-entry-time">11:35 AM</span>
                        </div>
                        <div class="log-entry manual">
                            **You (Karim)** replied to the user.
                            <span class="log-entry-time">11:46 AM</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Function to check if content contains Arabic characters (for RTL support)
            function containsArabic(text) {
                // Unicode range for most common Arabic characters
                return /[\u0600-\u06FF]/.test(text);
            }

            // 1. Get the ticket ID from the URL
            const urlParams = new URLSearchParams(window.location.search);
            const ticketId = parseInt(urlParams.get('id')) || 1; 

            // 2. Find the matching ticket in the globally available 'tickets' array (from data.js)
            const ticket = tickets.find(t => t.id === ticketId);

            if (ticket) {
                const priorityClass = `status-${ticket.priority}`;
                const descriptionElement = document.getElementById('ticketDescriptionContent');
                const agentContentElement = document.getElementById('agentMessageContent');
                const agentInfoElement = document.getElementById('agentMessageInfo');

                // --- RTL LOGIC (User Message) ---
                const isArabicTicket = containsArabic(ticket.description);

                if (isArabicTicket) {
                    descriptionElement.classList.add('rtl');

                    // --- RTL LOGIC (Agent Response) ---
                    const arabicResponse = "ÿ¥ŸÉÿ±ÿßŸã ŸÑÿ™ŸàÿßÿµŸÑŸÉ! ŸÑŸÇÿØ ÿ£ŸÉÿØÿ™ ŸÖÿ¥ŸÉŸÑÿ™ŸÉ Ÿàÿ£ŸÜÿß ÿ£ÿ®ÿØÿ£ ÿßŸÑÿπŸÖŸÑŸäÿ© ÿßŸÑÿ¢ŸÜ. ÿ≥ÿ£ÿ™ÿßÿ®ÿπ ŸÖÿπŸÉ ÿ®ÿ™ÿ≠ÿØŸäÿ´ ÿÆŸÑÿßŸÑ ÿßŸÑÿ≥ÿßÿπÿ© ÿßŸÑŸÇÿßÿØŸÖÿ©.";

                    // Update agent response content to Arabic
                    agentContentElement.textContent = arabicResponse;
                    // Apply RTL to agent response bubble
                    agentContentElement.classList.add('rtl'); 

                    // Update agent info text
                    agentInfoElement.textContent = "You (Agent) ¬∑ 11:45 AM";
                }

                // --- Inject Dynamic Content ---

                // HEADER
                document.getElementById('ticketStatusBadge').textContent = ticket.status.toUpperCase();
                document.getElementById('ticketStatusBadge').className = `status-badge ${priorityClass}`;
                document.getElementById('ticketTitle').textContent = `T-${ticket.id}: ${ticket.title}`;
                document.getElementById('ticketInfo').textContent = `Opened by User in **${ticket.category}**`;

                // CHAT THREAD (Initial Message)
                descriptionElement.textContent = ticket.description;

                // AUTOMATION LOGIC
                const automationElement = document.getElementById('automationTrigger');
                const logPriorityElement = document.getElementById('logPriority');

                // Update the automation message content and display it
                automationElement.style.display = 'block';
                automationElement.innerHTML = `<span>‚úÖ Automation: Priority set to **${ticket.priority.toUpperCase()}** based on content analysis.</span>`;

                // Update the priority log entry
                logPriorityElement.innerHTML = `**System Automation** triggered: Priority set to **${ticket.priority.toUpperCase()}**.
                    <span class="log-entry-time">11:35 AM</span>`;

                // PROPERTIES PANEL
                document.getElementById('propertyPriority').textContent = ticket.priority.toUpperCase();
                document.getElementById('propertyCategory').textContent = ticket.category;
            } else {
                // Fallback for an invalid ticket ID
                document.getElementById('ticketTitle').textContent = 'Error: Ticket Not Found';
            }
        });
    </script>
</body>
</html>